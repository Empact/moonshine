<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: Moonshine::Manifest::Rails::Rails [Moonshine]</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Module</span>
          Moonshine::Manifest::Rails::Rails
        </h1>
        <ol class='paths'>
          <li>
            <a href="../../../../files/lib/moonshine/manifest/rails/rails_rb.html">lib/moonshine/manifest/rails/rails.rb</a>
            (<a href="http://github.com/railsmachine/moonshine/tree/master/lib/moonshine/manifest/rails/rails.rb">view online</a>)
          </li>
        </ol>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000025">rails_bootstrap</a></li>
              <li><a href="#M000030">rails_directories</a></li>
              <li><a href="#M000029">rails_gems</a></li>
              <li><a href="#M000027">rails_logrotate</a></li>
              <li><a href="#M000026">rails_migrations</a></li>
              <li><a href="#M000028">rails_rake_environment</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='methods'>
              <h2>Public instance methods</h2>
              <div class='public-instance method' id='method-M000025'>
                <a name='M000025'>      </a>
                <div class='synopsis'>
                  <span class='name'>rails_bootstrap</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Attempt to bootstrap your application. Calls <tt>rake
                  moonshine:bootstrap</tt> which runs:
                  </p>
                  <pre>rake db:schema:load (if db/schema.rb exists)&#x000A;rake db:migrate (if db/migrate exists)</pre>
                  <p>
                  We then run a task to load bootstrap fixtures from <tt>db/bootstrap</tt>
                  (if it exists). These fixtures may be created with the included
                  <tt>moonshine:db:bootstrap:dump</tt> rake task.
                  </p>
                  <pre>rake moonshine:db:bootstrap</pre>
                  <p>
                  We then run the following task:
                  </p>
                  <pre>rake moonshine:app:bootstrap</pre>
                  <p>
                  The <tt>moonshine:app:bootstrap</tt> task does nothing by default. If
                  you&#8217;d like to have your application preform any logic on it&#8217;s
                  first deploy, overwrite this task in your <tt>Rakefile</tt>:
                  </p>
                  <pre>namespace :moonshine do&#x000A;  namespace :app do&#x000A;    desc &quot;Overwrite this task in your app if you have any bootstrap tasks that need to be run&quot;&#x000A;    task :bootstrap do&#x000A;      #&#x000A;    end&#x000A;  end&#x000A;end</pre>
                  <p>
                  All of this assumes one things. That your application can run &#8216;rake
                  environment&#8217; with an empty database. Please ensure your application
                  can do so!
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000025-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000025-source'>    <span class="ruby-comment cmt"># File lib/moonshine/manifest/rails/rails.rb, line 35</span>&#x000A;35:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rails_bootstrap</span>&#x000A;36:     <span class="ruby-identifier">rake</span> <span class="ruby-value str">'moonshine:bootstrap'</span>,&#x000A;37:       <span class="ruby-identifier">:alias</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'rails_bootstrap'</span>,&#x000A;38:       <span class="ruby-identifier">:refreshonly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,&#x000A;39:       <span class="ruby-identifier">:before</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exec</span>(<span class="ruby-value str">'rake db:migrate'</span>)&#x000A;40:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000030'>
                <a name='M000030'>      </a>
                <div class='synopsis'>
                  <span class='name'>rails_directories</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Essentially replicates the deploy:setup command from capistrano, but sets
                  up permissions correctly.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000030-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000030-source'>     <span class="ruby-comment cmt"># File lib/moonshine/manifest/rails/rails.rb, line 106</span>&#x000A;106:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rails_directories</span>&#x000A;107:     <span class="ruby-identifier">deploy_to_array</span> = <span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:deploy_to</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">'/'</span>).<span class="ruby-identifier">split</span>(<span class="ruby-value str">'/'</span>)&#x000A;108:     <span class="ruby-identifier">deploy_to_array</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>&#x000A;109:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">&gt;=</span> (<span class="ruby-identifier">deploy_to_array</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>)&#x000A;110:       <span class="ruby-identifier">file</span> <span class="ruby-value str">'/'</span><span class="ruby-operator">+</span><span class="ruby-identifier">deploy_to_array</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-identifier">index</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value str">'/'</span>), <span class="ruby-identifier">:ensure</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:directory</span>&#x000A;111:     <span class="ruby-keyword kw">end</span>&#x000A;112:     <span class="ruby-identifier">dirs</span> = [&#x000A;113:       <span class="ruby-node">&quot;#{configuration[:deploy_to]}&quot;</span>,&#x000A;114:       <span class="ruby-node">&quot;#{configuration[:deploy_to]}/shared&quot;</span>,&#x000A;115:       <span class="ruby-node">&quot;#{configuration[:deploy_to]}/releases&quot;</span>&#x000A;116:     ]&#x000A;117:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:shared_children</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)&#x000A;118:       <span class="ruby-identifier">shared_dirs</span> = <span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:shared_children</span>].<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{configuration[:deploy_to]}/shared/#{d}&quot;</span> }&#x000A;119:       <span class="ruby-identifier">dirs</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">shared_dirs</span>&#x000A;120:     <span class="ruby-keyword kw">end</span>&#x000A;121:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:app_symlinks</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)&#x000A;122:       <span class="ruby-identifier">dirs</span> <span class="ruby-operator">+=</span> [<span class="ruby-node">&quot;#{configuration[:deploy_to]}/shared/public&quot;</span>]&#x000A;123:       <span class="ruby-identifier">symlink_dirs</span> = <span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:app_symlinks</span>].<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{configuration[:deploy_to]}/shared/public/#{d}&quot;</span> }&#x000A;124:       <span class="ruby-identifier">dirs</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">symlink_dirs</span>&#x000A;125:     <span class="ruby-keyword kw">end</span>&#x000A;126:     <span class="ruby-identifier">dirs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span>&#x000A;127:       <span class="ruby-identifier">file</span> <span class="ruby-identifier">dir</span>,&#x000A;128:       <span class="ruby-identifier">:ensure</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:directory</span>,&#x000A;129:       <span class="ruby-identifier">:owner</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:user</span>],&#x000A;130:       <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:group</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:user</span>],&#x000A;131:       <span class="ruby-identifier">:mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'775'</span>&#x000A;132:     <span class="ruby-keyword kw">end</span>&#x000A;133:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000029'>
                <a name='M000029'>      </a>
                <div class='synopsis'>
                  <span class='name'>rails_gems</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Automatically install all gems needed specified in the array at
                  <tt>configuration[:gems]</tt>. This loads gems from
                  <tt>config/gems.yml</tt>, which can be generated from by running <tt>rake
                  moonshine:gems</tt> locally.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000029-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000029-source'>     <span class="ruby-comment cmt"># File lib/moonshine/manifest/rails/rails.rb, line 75</span>&#x000A; 75:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rails_gems</span>&#x000A; 76:     <span class="ruby-identifier">gemrc</span> = {&#x000A; 77:       <span class="ruby-identifier">:verbose</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,&#x000A; 78:       <span class="ruby-identifier">:gem</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;--no-ri --no-rdoc&quot;</span>,&#x000A; 79:       <span class="ruby-identifier">:update_sources</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,&#x000A; 80:       <span class="ruby-identifier">:sources</span> =<span class="ruby-operator">&gt;</span> [&#x000A; 81:         <span class="ruby-value str">'http://gems.rubyforge.org'</span>,&#x000A; 82:         <span class="ruby-value str">'http://gems.github.com'</span>,&#x000A; 83:       ]&#x000A; 84:     }&#x000A; 85:     <span class="ruby-identifier">gemrc</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:rubygems</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:rubygems</span>]&#x000A; 86:     <span class="ruby-identifier">file</span> <span class="ruby-value str">'/etc/gemrc'</span>,&#x000A; 87:       <span class="ruby-identifier">:ensure</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:present</span>,&#x000A; 88:       <span class="ruby-identifier">:mode</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'744'</span>,&#x000A; 89:       <span class="ruby-identifier">:owner</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'root'</span>,&#x000A; 90:       <span class="ruby-identifier">:group</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'root'</span>,&#x000A; 91:       <span class="ruby-identifier">:content</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">gemrc</span>.<span class="ruby-identifier">to_yaml</span>&#x000A; 92:     <span class="ruby-comment cmt">#stub for dependencies</span>&#x000A; 93:     <span class="ruby-identifier">exec</span> <span class="ruby-value str">'rails_gems'</span>, <span class="ruby-identifier">:command</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'true'</span>&#x000A; 94:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:gems</span>]&#x000A; 95:     <span class="ruby-identifier">configuration</span>[<span class="ruby-identifier">:gems</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">gem</span><span class="ruby-operator">|</span>&#x000A; 96:       <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:source</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">gem</span>[<span class="ruby-identifier">:source</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">gem</span>[<span class="ruby-identifier">:source</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/gems.github.com/</span>&#x000A; 97:       <span class="ruby-identifier">gem</span>(<span class="ruby-identifier">gem</span>[<span class="ruby-identifier">:name</span>], {&#x000A; 98:         <span class="ruby-identifier">:version</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">gem</span>[<span class="ruby-identifier">:version</span>],&#x000A; 99:         <span class="ruby-identifier">:source</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">gem</span>[<span class="ruby-identifier">:source</span>]&#x000A;100:       })&#x000A;101:     <span class="ruby-keyword kw">end</span>&#x000A;102:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000027'>
                <a name='M000027'>      </a>
                <div class='synopsis'>
                  <span class='name'>rails_logrotate</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Rotates the logs for this rails app
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000027-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000027-source'>    <span class="ruby-comment cmt"># File lib/moonshine/manifest/rails/rails.rb, line 49</span>&#x000A;49:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rails_logrotate</span>&#x000A;50:     <span class="ruby-identifier">logrotate</span>(<span class="ruby-node">&quot;#{configuration[:deploy_to]}/shared/log/*.log&quot;</span>, {&#x000A;51:       <span class="ruby-identifier">:options</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">%w(daily missingok compress delaycompress sharedscripts)</span>,&#x000A;52:       <span class="ruby-identifier">:postrotate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;touch #{configuration[:deploy_to]}/current/tmp/restart.txt&quot;</span>&#x000A;53:     })&#x000A;54:     <span class="ruby-identifier">file</span> <span class="ruby-node">&quot;/etc/logrotate.d/#{configuration[:deploy_to].gsub('/','')}sharedlog.conf&quot;</span>, <span class="ruby-identifier">:ensure</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:absent</span>&#x000A;55:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000026'>
                <a name='M000026'>      </a>
                <div class='synopsis'>
                  <span class='name'>rails_migrations</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Runs <a href="Rails.html">Rails</a> migrations. These are run on each
                  deploy to ensure consistency! No more 500s when you forget to <tt>cap
                  deploy:migrations</tt>
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000026-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000026-source'>    <span class="ruby-comment cmt"># File lib/moonshine/manifest/rails/rails.rb, line 44</span>&#x000A;44:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rails_migrations</span>&#x000A;45:     <span class="ruby-identifier">rake</span> <span class="ruby-value str">'db:migrate'</span>&#x000A;46:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000028'>
                <a name='M000028'>      </a>
                <div class='synopsis'>
                  <span class='name'>rails_rake_environment</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  This task ensures Rake is installed and that <tt>rake environment</tt>
                  executes without error in your <tt>rails_root</tt>.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000028-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000028-source'>    <span class="ruby-comment cmt"># File lib/moonshine/manifest/rails/rails.rb, line 59</span>&#x000A;59:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rails_rake_environment</span>&#x000A;60:     <span class="ruby-identifier">package</span> <span class="ruby-value str">'rake'</span>, <span class="ruby-identifier">:provider</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:gem</span>, <span class="ruby-identifier">:ensure</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:installed</span>&#x000A;61:     <span class="ruby-identifier">exec</span> <span class="ruby-value str">'rake tasks'</span>,&#x000A;62:       <span class="ruby-identifier">:command</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'rake -T &gt; /dev/null'</span>,&#x000A;63:       <span class="ruby-identifier">:cwd</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rails_root</span>,&#x000A;64:       <span class="ruby-identifier">:environment</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;RAILS_ENV=#{ENV['RAILS_ENV']}&quot;</span>,&#x000A;65:       <span class="ruby-identifier">:require</span> =<span class="ruby-operator">&gt;</span> [&#x000A;66:         <span class="ruby-identifier">exec</span>(<span class="ruby-value str">'rails_gems'</span>),&#x000A;67:         <span class="ruby-identifier">package</span>(<span class="ruby-value str">'rake'</span>)&#x000A;68:       ]&#x000A;69:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
